CREATE TABLE IF NOT EXISTS tbl_cliente (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(50) NOT NULL,
    COGNOME VARCHAR(50) NOT NULL,
    EMAIL VARCHAR(50) NOT NULL,
    CELLULARE VARCHAR(50) NOT NULL,
    CODICE_FISCALE VARCHAR(50) NOT NULL,
    DATA_DI_NASCITA VARCHAR(50) NOT NULL,
    CITTA VARCHAR(50) NOT NULL,
    VIA VARCHAR(50) NOT NULL,
    N_CIVICO VARCHAR(50) NOT NULL,
    CAP VARCHAR(50) NOT NULL,
    NUM_CARTA VARCHAR(50) NOT NULL,
    CVV_CARTA VARCHAR(50) NOT NULL,
    INTESTATARIO_CARTA VARCHAR(50) DEFAULT NULL,
    SCADENZA_CARTA DATE DEFAULT NULL,
    RUOLO VARCHAR(50) DEFAULT 'cliente',
    UTENTE_PASSWORD VARCHAR(50) DEFAULT '1',
    UNIQUE KEY (EMAIL)
    );

CREATE TABLE IF NOT EXISTS tbl_filiale (
    NOME_FILIALE VARCHAR(50) NOT NULL,
    SEDE VARCHAR(50) NOT NULL,
    CODICE_ZONA_FILIALE VARCHAR(50) NOT NULL,
    PRIMARY KEY (CODICE_ZONA_FILIALE)
    );

CREATE TABLE IF NOT EXISTS tbl_dipendente (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    NOME VARCHAR(50) NOT NULL,
    COGNOME VARCHAR(50) NOT NULL,
    EMAIL VARCHAR(50) NOT NULL,
    VIA VARCHAR(50) NOT NULL,
    N_CIVICO VARCHAR(50) NOT NULL,
    CAP VARCHAR(50) NOT NULL,
    CITTA VARCHAR(50) NOT NULL,
    CODICE_FISCALE VARCHAR(50) NOT NULL,
    DATA_DI_NASCITA VARCHAR(50) NOT NULL,
    DATA_ASSUNZIONE DATE DEFAULT NULL,
    PAGA_ORARIA FLOAT NOT NULL,
    CODICE_ZONA VARCHAR(50) DEFAULT NULL,
    RUOLO VARCHAR(50) DEFAULT 'dipendente',
    UTENTE_PASSWORD VARCHAR(50) DEFAULT '1',
    FOREIGN KEY (CODICE_ZONA) REFERENCES tbl_filiale (CODICE_ZONA_FILIALE)
    );

CREATE TABLE IF NOT EXISTS tbl_fornitore (
    P_IVA VARCHAR(11) NOT NULL,
    NOME VARCHAR(50) NOT NULL,
    CITTA VARCHAR(30) NOT NULL,
    VIA VARCHAR(30) NOT NULL,
    CAP VARCHAR(30) NOT NULL,
    PRIMARY KEY (P_IVA)
    );

CREATE TABLE IF NOT EXISTS tbl_fornitura (
    ID_FORNITURA VARCHAR(50) NOT NULL,
    P_IVA VARCHAR(50) NOT NULL,
    CODICE_ZONA VARCHAR(50) NOT NULL,
    PREZZO FLOAT,
    DATA_ACQUISTO DATE,
    DATA_SPEDIZIONE DATE,
    FOREIGN KEY (P_IVA) REFERENCES tbl_fornitore(P_IVA),
    PRIMARY KEY (ID_FORNITURA)
    );

CREATE TABLE IF NOT EXISTS tbl_prodotto (
    NOME_PRODOTTO VARCHAR(50) NOT NULL,
    PREZZO_PRODOTTO FLOAT NOT NULL,
    QUANTITA INT NOT NULL,
    PROVENIENZA VARCHAR(50) NOT NULL,
    ID_FORNITURA VARCHAR(50) NOT NULL,
    ID_PRODOTTO VARCHAR(50) NOT NULL,
    FOREIGN KEY (ID_FORNITURA) REFERENCES tbl_fornitura(ID_FORNITURA),
    PRIMARY KEY (ID_PRODOTTO)
    );

CREATE TABLE IF NOT EXISTS tbl_carrello (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    DATA_ACQUISTO DATE DEFAULT NULL,
    QUANTITA_PRODOTTO INT NOT NULL,
    PREZZO_TOTALE FLOAT NOT NULL,
    EMAIL_CLIENTE VARCHAR(50),
    FOREIGN KEY (EMAIL_CLIENTE) REFERENCES tbl_cliente (EMAIL) ON UPDATE CASCADE
    );

CREATE TABLE IF NOT EXISTS tbl_ordine (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    FATTURA VARCHAR(50) NOT NULL,
    NUMERO_ORDINE INT DEFAULT NULL,
    ID_CARRELLO INT NOT NULL,
    INDIRIZZO_SPEDIZIONE VARCHAR(50) DEFAULT NULL,
    STATO_ORDINE VARCHAR(50) DEFAULT 'non gestito',
    FOREIGN KEY (ID_CARRELLO) REFERENCES tbl_carrello (ID)
    );

CREATE TABLE IF NOT EXISTS tbl_aggiunto_in (
    ID_PRODOTTO VARCHAR(50) NOT NULL,
    ID_CARRELLO INT NOT NULL,
    FOREIGN KEY (ID_PRODOTTO) REFERENCES tbl_prodotto (ID_PRODOTTO),
    FOREIGN KEY (ID_CARRELLO) REFERENCES tbl_carrello (ID)
    );

CREATE TABLE IF NOT EXISTS tbl_corriere (
    P_IVA VARCHAR(50) NOT NULL,
    NOME VARCHAR(30) NOT NULL,
    TELEFONO VARCHAR(50) NOT NULL,
    EMAIL VARCHAR(30) NOT NULL,
    PRIMARY KEY (P_IVA)
);

CREATE TABLE IF NOT EXISTS tbl_gestito_da (
    ID_FILIALE VARCHAR(50) NOT NULL,
    CODICE_ORDINE INTEGER NOT NULL,
    FOREIGN KEY (ID_FILIALE) REFERENCES tbl_filiale (CODICE_ZONA_FILIALE),
    FOREIGN KEY (CODICE_ORDINE) REFERENCES tbl_ordine (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS tbl_spedizione (
    NUMERO_TRACCIAMENTO VARCHAR(50) NOT NULL,
    P_IVA_CORRIERE VARCHAR(50) NOT NULL,
    NUMERO_ORDINE VARCHAR(50) NOT NULL,
    DATA_PARTENZA DATE NOT NULL,
    DATA_ARRIVO DATE NOT NULL,
    FOREIGN KEY (P_IVA_CORRIERE) REFERENCES tbl_corriere (P_IVA),
    PRIMARY KEY (NUMERO_TRACCIAMENTO)
);

CREATE TABLE IF NOT EXISTS tbl_emette_spedizione (
   CODICE_ZONA_FILIALE VARCHAR(50) NOT NULL,
   NUMERO_TRACCIAMENTO VARCHAR(50) NOT NULL,
   FOREIGN KEY (CODICE_ZONA_FILIALE) REFERENCES tbl_filiale (CODICE_ZONA_FILIALE),
   FOREIGN KEY (NUMERO_TRACCIAMENTO) REFERENCES tbl_spedizione (NUMERO_TRACCIAMENTO)
);

CREATE TABLE IF NOT EXISTS tbl_magazzino (
    CODICE_MAGAZZINO VARCHAR(50) NOT NULL,
    ID_PRODOTTO VARCHAR(50) NOT NULL,
    QUANTITA_PRODOTTO INT NOT NULL,
    NOME_PRODOTTO VARCHAR(50) DEFAULT NULL,
    NOME_MAGAZZINO VARCHAR(50) DEFAULT NULL,
    FOREIGN KEY (CODICE_MAGAZZINO) REFERENCES tbl_filiale(CODICE_ZONA_FILIALE)
);

CREATE TABLE IF NOT EXISTS tbl_ticketing (
    ID INT AUTO_INCREMENT PRIMARY KEY,
    TITOLO VARCHAR(50) NOT NULL,
    DESCRIZIONE VARCHAR(255) NOT NULL,
    GESTITO_DA VARCHAR(255) DEFAULT NULL,
    CREATO_DA VARCHAR(50) NULL,
    DATA_CREAZIONE DATE NOT NULL,
    STATO VARCHAR(50) DEFAULT 'Non gestito'
);





